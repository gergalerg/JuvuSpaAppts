{% extends "base.html" %}
{% block html_head %}
<script type="text/javascript" src="/static/js/d3/d3.js"></script>
<script type="text/javascript" src="/static/js/d3/d3.time.js"></script>
<link rel="stylesheet/less" href="/static/rad.less" type="text/css">
<script src="/static/js/less.js" type="text/javascript"></script>
<script src="/static/js/jquery.tmpl.js" type="text/javascript"></script>
<script src="/static/js/knockout-1.2.1.debug.js" type="text/javascript"></script>
<style>
	@import url(http://fonts.googleapis.com/css?family=Pacifico|Chewy|Dancing+Script:400,700);
	@import url(http://fonts.googleapis.com/css?family=Josefin+Sans:400,100|Istok+Web|Philosopher);
</style>
<script type="text/javascript">

$(function() {

    var viewModel = {
        current: ko.observable("Wants Pawn Term, "),
    };

    var day = d3.time.format("%w"),
        week = d3.time.format("%U"),
        month = d3.time.format("%m"),
        format = d3.time.format("%A, %B %d %Y");

    var year = d3.time.days(new Date(2011, 0, 1), new Date(2012, 0, 1));

    var h = 250, w = 1024;

    var x = d3.scale.linear().domain([0,53]).range([10, 914]),
        y = d3.scale.linear().domain([0,7]).range([20,h]),
        r = d3.scale.linear().domain([0,1]).range([5,10]),
        r_big = d3.scale.linear().domain([0,1]).range([30, 43]),
        c0 = d3.scale.linear().domain([0,1]).range(
            ["hsl(250, 50%, 50%)", "hsl(350, 100%, 50%)"]
            ).interpolate(d3.interpolateHsl);
        c1 = d3.scale.linear().domain([0,1]).range(
            ["hsl(150, 50%, 50%)", "hsl(250, 100%, 50%)"]
            ).interpolate(d3.interpolateHsl);

    var c2 = d3.scale.linear().domain([0,11]).range(
            ["hsl(0, 50%, 90%)", "hsl(360, 50%, 90%)"]
            ).interpolate(d3.interpolateHsl);

    var xm = d3.scale.linear().domain([0,7]).range([100, 814]),
        ym = d3.scale.linear().domain([0,4]).range([20 + h, h * 2]);

    var data = jQuery.map(year,
        function(d, i){
            return {
                "week_of_year": week(d),
                "day_of_week": day(d),
                "label": format(d),
                "date": d,
            }
        }
    );

    var vis = d3.select("#show")
        .append("svg:svg")
        .attr("width", w)
        .attr("height", 2.6 * h);

    vis.selectAll("circle")
        .data(data)
        .enter().append("svg:circle")
        .attr("cx", function(d) { return x(d.week_of_year) })
        .attr("cy", function(d) { return y(d.day_of_week) })
        .attr("stroke-width", "none")
        .attr("fill", function(d) {
            return (month(d.date) % 2 == 0) ? c1(Math.random()) : c0(Math.random());
        })
        .attr("fill-opacity", .5)
//        .attr("visibility", "hidden")
        .attr("r", function() { return r(Math.random()) })
		.on("mouseover", function(d) {
		    viewModel.current(d.label);
			d3.select(this).transition()
				.attr("r", function() { return r(Math.random()) * 3 })
				.delay(0)
				.duration(2500)
				.ease("elastic", 3, .3)
		}).on("mouseout", function(d) {
		    viewModel.current("Select Date");
			d3.select(this).transition()
				.attr("r", function() { return r(Math.random()) })
				.delay(100)
				.duration(333)
		}).on("click", function(d) {
	        var m = month(d.date);
	        var the_month = d3.selectAll("circle").filter(function(d, i) { return (month(d.date) == m) });
	        var base_week = week(new Date(2011, +m, 1)); // week_of_year
	        console.log(m, base_week);

	        the_month.transition()
                .duration(2000)
                .attr("cx", function(d) { return xm(d.day_of_week) })
                .attr("cy", function(d) { return ym(d.week_of_year - base_week) })
				.attr("r", function() { return r_big(Math.random()) });

			d3.selectAll("circle")
			    .filter(function(d, i) { return (month(d.date) != m) })
                .duration(2000)
			    .attr("visibility", "hidden");
	    });

    function crambery() {
        window.setTimeout(crambery, 180000);
        for (var i = 0; i < 12; i++) {
            d3.select("body").transition()
                .delay(15000 * i)
                .duration(15000)
                .style("background-color", c2(i));
        }
    }
    crambery();

    ko.applyBindings(viewModel);

});

</script>
{% endblock %}
{% block title %}Dashboard - SpaStalker{% endblock %}
{% block body %}
<div class="container">
<div class="row">
<div class="twelve columns" style="float: none">{# The float setting here is to finesse a performance issue with the SVG response when float:left. #}
<div id="hull" class="panel">

    <h1 data-bind="text: current"></h1>
    <p>Glide your mouse over the circles below to find a date, then click to 
    make that date the current date. ..dare worsted ladle gull hoe lift
    wetter murder inner ladle cordage, honor itch offer lodge dock florist.
    Disk ladle gull orphan worry ladle cluck wetter putty ladle rat hut, an
    fur disk raisin pimple colder Ladle Rat Rotten Hut.</p>

    <div id="show"></div>

</div>{# hull #}
</div></div>{# columns row #}
</div>{# container #}
{% endblock %}
