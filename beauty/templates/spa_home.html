{% extends "spa_base.html" %}
{% block html_head %}
<link rel="stylesheet/less" href="/static/spa_home.less" type="text/css">
<script src="/static/js/less.js" type="text/javascript"></script>

<script type="text/javascript">

function toc_in() {
    $("#toc").switchClass("seven", "two", 500, 'easeOutBounce', function() {
        $("#main_frame").fadeIn();
    });
}

function toc_out() {
    $("#main_frame").fadeOut(150, function() {
        $("#toc").switchClass("two", "seven", 150);
    });
}



//-------------------------------------------------------
// View Model
//

var viewModel = {

    // Track the current "view" the user is looking at.
    viewing: ko.observable()

};

//-------------------------------------------------------
// View
//

var View = {
    // This is the last view the user was looking at, used for determining correct transition to a new view.
    previous_view: "toc",
};

// Update the "indicate" CSS class.
viewModel.viewing.subscribe(function(view) {
    $(".indicate").removeClass("indicate");
    $("#" + view + "_link").addClass("indicate");
});

// Track and update visible pane and TOC width.
viewModel.viewing.subscribe(function(view) {

    // I think this is prevented by the routes thingy, but it can't hurt.
    if (view == View.previous_view) { return };

    // Are we going to the TOC?
    if (view == "toc") {
        toc_out(); // The rest of the UI remains static,

    // No, we're going to one of the panes.
    } else {
        // Clear the previous view.
        if (View.previous_view == "toc") {
            toc_in();
        } else {
            $(".current_pane").hide("slide").removeClass("current_pane");
        }
        // Show the chosen pane.
        $("#pane_" + view).show("slide").addClass("current_pane");
    };

    // Update history for next call.
    View.previous_view = view;
});

//-------------------------------------------------------
// Route URLs.
//

var routey = Backbone.Router.extend({

    routes: {
        "toc": "toc",
        "step/:num": "step",
    },

    toc: function() {
        viewModel.viewing("toc");
    },

    step: function(num) {
        num = +num;
        if (num >= 0 && num <= 4) {
            viewModel.viewing(num);
            $(".current_pane").hide().removeClass("current_pane");
            $("#pane_" + num).show().addClass("current_pane");

        } else {
            routes.navigate("toc", true);
        }
    },

});

var routes = new routey();

//-------------------------------------------------------
// Initial bootstrap.
//

$(function(){
    $("#main_frame").hide();
    $(".pane").hide();
    ko.applyBindings(viewModel);
    crambery(3); // Animate color cycle at three minutes per complete rainbow. ;)
//    $("#title_bar").hover(toc_in, toc_out);
    if (!Backbone.history.start()) {
        // Default to Step 1.
        routes.navigate("toc", true);
    }

});
</script>
{% endblock %}

{% block title %}Spa Home{% endblock %}

{% block header %}
<div id="title_bar">
  <h1>{{ spa_name|default:"&lt;SPA NAME&gt;" }}</h1> <h3 data-bind="text:viewing">Home</h3>
</div>
{% endblock %}

{% block toc %}
    <h3><a id="0_link" href="#step/0">Info</a></h3>
    <h3><a id="1_link" href="#step/1">Services</a></h3>
    <h3><a id="2_link" href="#step/2">Customize</a></h3>
    <h3><a id="3_link" href="#step/3">Staff</a></h3>
    <h3><a id="4_link" href="#step/4">Calendar</a></h3>
{% endblock %}

{% block pane_0 %}
placeholder for info page
{% endblock %}

{% block pane_1 %}
placeholder for services page
{% endblock %}

{% block pane_2 %}
placeholder for customize page
{% endblock %}

{% block pane_3 %}
placeholder for staff page
{% endblock %}

{% block pane_4 %}
placeholder for calendar page
{% endblock %}


{% block body %}
{% endblock %}
